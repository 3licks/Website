{% from "_formhelpers.html" import render_field %}
{% extends "base.html" %}
{% block body %}

{% if tickets %}
<p>Your current tickets:</p>

<table class="tickets">
<tr><th>Type</th><th>Status</th></tr>

{% for t in tickets %}

<tr class="
{{ loop.cycle('odd', 'even') }}
{% if t.paid %}paid{% endif%}
{% if t.expired() %}expired{% endif %}
">
<td>{{ t.type.name }}</td>
<td>
    {% if t.paid %}
    Paid
    {% elif t.expired() %}
    Expired
    {% else %}
    Pending
    {% endif %}
</td>
</tr>

{% endfor %}

</table>
<br/>

{% endif %}

{% if payments %}
Your payments:

<table>
<tr><th>Type</th><th>Amount</th><th>Progress</th><th></th></tr>
{% for p in payments %}
<tr>

<td>{{ p.name }}</td>
<td>{{ format_price(p.amount) }}</td>
<td>{{ p.state }}</td>
<td><a href="">Cancel</a></td>

</tr>
{%endfor%}
</table>

{% endif %}

<p>We don't have a final budget yet, so we're currently only letting people
   put a deposit down for their tickets.</p>

<ul>
    <li>Deposit pre-sales cost <strong>£30</strong> per ticket.</li>
    <li>They will entitle you to pay the rest of your ticket price at a £5 discount to the full price.</li>
    <li>We anticipate the full ticket price to be between £75 to £95.
        If the final ticket price is within this range, you'll have to pay a £10
        administration fee if you want a refund of your deposit.</li>
</ul>

<form method=post class="choose-prepay-tickets">
    {{form.hidden_tag()}}
    <h2>Tickets</h2>
<dl>
    {{ render_field(form.count) }}
</dl>
    <input type=submit value="Confirm"/>
    <p>Total amount for deposit: {{ format_price(total) }}.</p>
</form>

<p>Taking credit card payments for a small event like us is really expensive, so the only
payment methods we accept are bank-to-bank. If this is really a problem for you, please
<a href="mailto:tickets@emfcamp.org">let us know</a>.
</p>
{% if bought %}

<h3>Paying in Pounds</h3>
<p>

<ul>
    <li><a href="{{ url_for('gocardless_start') }}">Checkout &amp; Pay by GoCardless (direct debit)</a></li>
    <li><a href="{{ url_for('transfer_start') }}">Checkout &amp; Pay by bank transfer</a></li>
</ul>
{% endif %}

<h3>Paying in Euros</h3>
<p>If you want to pay in Euros, we're working on it. Email tickets@emfcamp.org and we'll let
you know when our Euro bank account is ready.</p>

{% endblock %}
