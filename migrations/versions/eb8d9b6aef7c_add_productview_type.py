"""Add ProductView.type

Revision ID: eb8d9b6aef7c
Revises: 7fde5ade7c65
Create Date: 2018-06-10 17:48:20.910926

"""

# revision identifiers, used by Alembic.
revision = 'eb8d9b6aef7c'
down_revision = '7fde5ade7c65'

from alembic import op
import sqlalchemy as sa
from sqlalchemy.ext.declarative import declarative_base

from main import db

Base = declarative_base()

class ProductView(Base):
    __tablename__ = 'product_view'
    id = db.Column(db.Integer, primary_key=True)
    type = db.Column(db.String, nullable=False)
    name = db.Column(db.String, nullable=False, index=True)


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('product_view', schema=None) as batch_op:
        batch_op.add_column(sa.Column('type', sa.String(), nullable=True))

    bind = op.get_bind()
    session = sa.orm.Session(bind=bind)

    for view in session.query(ProductView):
        if view.name == 'tees':
            view.type = 'items'
        elif view.name == 'hire':
            view.type = 'hire'
        else:
            view.type = 'tickets'

    session.commit()

    with op.batch_alter_table('product_view', schema=None) as batch_op:
        batch_op.alter_column('type',
               existing_type=sa.VARCHAR(),
               nullable=False)

    # ### end Alembic commands ###

def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('product_view', schema=None) as batch_op:
        batch_op.drop_column('type')

    # ### end Alembic commands ###
