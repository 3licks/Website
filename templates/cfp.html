{% from "_formhelpers.html" import render_field %}
{% extends "base.html" %}
{% block title %}Call for Participation{% endblock %}
{% block body %}
  {% if has_errors %}
  <div class="alert alert-danger">Could not submit your proposal. Please <a href="#cfp-errors" class="alert-link">check below</a> and try again.</div>
  {% endif %}

  <h2>Call for Participation</h2>
  <div class="collapse in" id="what">
    <p class="emphasis">Electromagnetic Field is a UK camping festival for those
      with an inquisitive mind or an interest in making things: hackers, artists,
      geeks, crafters, scientists, and engineers. It's happening near
      <a href="http://wiki.emfcamp.org/wiki/Getting_Here">Guildford, Surrey</a>
      on August 5<sup>th</sup>&mdash;7<sup>th</sup>, and tickets are
      <a href="/">on sale now</a> for Â£{{ full_price }}. Our last festival in
      2014 had 1,300 attendees; this year we're aiming for 1,500.</p>

    <p>We're looking for people to talk, share, and demonstrate the things they
      love. We're especially keen to hear from people with
      <a href="{{ url_for('base.diversity') }}">different backgrounds</a> than
      you'd expect to find at a technology conference. We're not just looking
      for talks: we also want installations, workshops, and games.</p>

    <p>At previous events we've heard about everything from genetic modification
      to electronics, blacksmithing to high-energy physics, reverse engineering
      to lock picking, computer security to crocheting, and quadcopters to beer
      brewing.  </p>

    <p>If you're enthusiastic about it, we are too! You don't need to be a
      professional or an expert to present: <strong>impostors are
      welcome</strong>.</p>
  </div>

  <a class="collapse-toggle" role="button" data-toggle="collapse" href="#selection" aria-expanded="true" aria-controls="#selection">
    <h3>Selection<small class="glyphicon glyphicon-chevron-down"></small></h3>
  </a>
  <div class="collapse in" id="selection">
    <p>After you submit a proposal, it will be considered anonymously by a diverse
      selection panel. We may take into account other factors later on in the process
      to see where we can support you.</p>
    <p>For more on this see our <a href="{{ url_for('.guidance', _anchor='process') }}" target="_blank">guidance</a>.</p>
  </div>

  <a class="collapse-toggle" role="button" data-toggle="collapse" href="#money" aria-expanded="true" aria-controls="#money">
    <h3>Money<small class="glyphicon glyphicon-chevron-down"></small></h3>
  </a>
  <div class="collapse in" id="money">
    <p>EMF is a non-profit community event, entirely run by unpaid volunteers. All of
      the ticket cost goes directly towards turning a field into a habitable and amazing place
      to spend a weekend, and everyone who attends contributes to making it a success.</p>

    <p>Because of this, we'd like everyone who participates to buy a ticket and stick around for
      the whole event. We don't have the budget to pay speakers, although we have a
      limited amount of money set aside to help those who otherwise can't to afford to come, or
      who can only attend for the day of their talk. Please let us know if that's the case.</p>
  </div>

  <a class="collapse-toggle" role="button" data-toggle="collapse" href="#guidance" aria-expanded="true" aria-controls="#guidance">
    <h3>Submit a proposal<small class="glyphicon glyphicon-chevron-down"></small></h3>
  </a>
  <div class="collapse in" id="guidance">
    <p>We need a rough idea of what you want to present at EMF, what sort of
      resources you'll need, and how long you'll expect it to last. If you need some
      help writing your proposal, <a href="mailto:{{ config['CONTENT_EMAIL'][1] }}">we're happy to
      help</a>. If you're not confident speaking, we'll help you out however we
      can.</p>

    <p>For more detailed information about the form and what we're looking for
      please see our <a href="{{ url_for('.guidance') }}" target="_blank">guidance page.</a></p>
  </div>

  {% if not current_user.is_authenticated() %}
  <p>If you've already bought a ticket for this year, please <a href="{{ url_for('users.login') }}">log in</a>
     so we can link the submission to your account.</p>
  {% endif %}

  <div class="well">
    <p>
      The review process is anonymised, so please don't include any details that make
      you identifiable in the title or description of your submission.
    </p>
    <p>
      If your proposal is accepted you'll have a chance to tweak what is displayed
      in the schedule later (e.g. to add credits, expand the description)
    </p>
  </div>

  <label class="visible-xs">
  Select the category that most closely describes your proposal
  </label>

  <ul class="nav nav-tabs cfp-types" role="navigation" id="cfp-errors">
    {% for form in forms %}
      <li {% if form.type == active_cfp_type -%} class="active" {%- endif %}>
        <a href="{{ url_for('cfp.main', cfp_type=form.type) }}" data-target="#{{ 'tab_' + form.type }}" data-toggle="tab">
          {% if form.type == 'talk' %}
            <h4>Talk</h4>
            <p>Held on one of our stages</p>
          {% elif form.type == 'workshop' %}
            <h4>Workshop</h4>
            <p>Demonstration or performance</p>
          {% elif form.type == 'installation' %}
            <h4>Installation</h4>
            <p>Creation around the site</p>
          {% endif %}
        </a>
        </button>
      </li>
    {% endfor %}
  </ul>

  <div class="tab-content cfp-tab">
    {% for form in forms %}

    <div class="tab-pane {%- if form.type == active_cfp_type %} active {%- endif %}" id="{{ 'tab_' + form.type }}">
    <form action={{ url_for('cfp.main', cfp_type=form.type) }} method="post" class="form-horizontal cfp-form" role="form">
      <fieldset>
      {{ form.hidden_tag() }}
      <p><a href="{{ url_for('.guidance', _anchor=form.type) }}" target="_blank">Further information on what we expect from a {{ form.type }}.</a></p>
      {% if not current_user.is_authenticated() %}
        {% if current_user.is_anonymous() %}
          {{ render_field(form.name, 9, placeholder="Your name", help_link=url_for('.guidance', _anchor='form-name')) }}
          {{ render_field(form.email, 9, help_link=url_for('.guidance', _anchor='form-email'), placeholder="We need this to update you about your talk and so you can log back in") }}
        {% else %}
          {{ render_field(form.name, 9, placeholder="Your name", help_link=url_for('.guidance', _anchor='form-name')) }}
        {% endif %}
      {% endif %}

      {{ render_field(form.title, 9, help_link=url_for('.guidance', _anchor='form-title'), placeholder="A one-sentence summary") }}
      </fieldset>

      <fieldset>
      {{ render_field(form.description, 9, help_link=url_for('.guidance', _anchor='form-description'), placeholder="An anonymised description to send to the reviewers.") }}
      {{ render_field(form.requirements, 9, help_link=url_for('.guidance', _anchor='form-requirements'), placeholder="Do you have any requirements (e.g. atari to HDMI adaptors, 3-phase power)?") }}

      {% if form.type == 'talk' %}
        {{ render_field(form.length, 9, help_link=url_for('.guidance', _anchor='form-length')) }}
      {% elif form.type == 'workshop' %}
        {{ render_field(form.length, 9, help_link=url_for('.guidance', _anchor='form-length'), placeholder="Your best guess, whether in minutes or days") }}
        {{ render_field(form.attendees, 9, help_link=url_for('.guidance', _anchor='form-attendees'), placeholder="The number of people you can accommodate in your workshop") }}

        {{ render_field(form.cost, 9, help_link=url_for('.guidance', _anchor='form-cost'), placeholder="If attendees need to pay for materials") }}
      {% elif form.type == 'installation' %}
        {{ render_field(form.size, 9, help_link=url_for('.guidance', _anchor='form-size'), placeholder="We need to know how much space to reserve") }}
      {% endif %}

      {{ render_field(form.notice_required, 9, help_link=url_for('.guidance', _anchor='form-notice-required')) }}

      </fieldset>
      <fieldset>

        <div class="col-md-9 col-sm-offset-3">
          <label class="checkbox">
            {{ form.needs_help() }}
            {% if form.type == 'talk' %}
            I'd like help with preparing this proposal or during the talk.
            {% elif form.type == 'workshop' %}
            I'd like help with preparing this proposal or during the workshop.
            {% elif form.type == 'installation' %}
            I'd like help with preparing this proposal or the installation itself.
            {% endif %}
            <a href="{{ url_for('.guidance', _anchor='form-help') }}" target="_blank">?</a>
          </label>
          {% for error in form.needs_help.errors %}
          <div class="help-block">{{ error }}</div>
          {% endfor %}
        </div>

        <div class="col-md-9 col-sm-offset-3">
          <label class="checkbox">
            {{ form.needs_money() }}
            {% if form.type == 'talk' %}
            I'll be seeking funding in order to present this talk.
            {% elif form.type == 'workshop' %}
            I'll be seeking funding in order to run this workshop.
            {% elif form.type == 'installation' %}
            I'll be seeking funding in order to create this installation.
            {% endif %}

            <a href="{{ url_for('.guidance', _anchor='form-funding') }}" target="_blank">?</a>
          </label>
          {% for error in form.needs_money.errors %}
          <div class="help-block">{{ error }}</div>
          {% endfor %}
        </div>
      </fieldset>
      <p></p>

      {% if current_user.is_anonymous() or not current_user.diversity %}
      <fieldset>
        <div class="col-md-11 col-md-offset-1">
        <div class="panel panel-warning">
          <div class="panel-heading">
            If you're comfortable telling us a little bit about yourself, we'd appreciate it.
            This information won't be available to the selection panel &ndash; we'll only use it to help find out
            how well we're doing with outreach.
          </div>
          <div class="row">
          <div id="diversity" class="col-md-10 col-md-offset-1">
            <p></p>
            {{ render_field(form.diversity.age, True) }}
            {{ render_field(form.diversity.gender, True) }}
            {{ render_field(form.diversity.ethnicity, True) }}
          </div>
          </div>
        </div>
        </div>
      </fieldset>
      {% endif %}

      <div class="form-actions">
        <button type="submit" name="Create" class="btn btn-success btn-lg pull-right debounce">Submit proposal</button>
      </div>

    </form>
    </div>

    {% endfor %}

  </div>

{% endblock %}

{% block foot %}
<script type="text/javascript">
$(function() {
  'use strict';
  // If the user has already made a submission, hide all the blurb.
  // Fallback is just to show it.
  var has_proposals = {{ has_proposals|tojson }};
  if (has_proposals) {
    $('.collapse').removeClass('in');
  }

  // Copy values across when the user switches tab
  $('.cfp-types a').on('show.bs.tab', function(e) {
    var $prev = $(e.relatedTarget);
    var $curr = $(this);
    var $prev_tab = $($prev.data('target'));
    var $curr_tab = $($curr.data('target'));
    $.each(['name', 'email', 'title', 'description', 'need_finance'], function(i, f) {
      var $curr_f = $curr_tab.find('[name=' + f + ']');
      var $prev_f = $prev_tab.find('[name=' + f + ']');
      if ($curr_f.attr('type') == 'checkbox') {
          $curr_f.prop('checked', $prev_f.prop('checked'));
      } else {
          $curr_f.val($prev_f.val());
      }
    });

    return true;
  });
});
</script>
{% endblock %}
