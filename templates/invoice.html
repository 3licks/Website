{% extends 'base.html' %}

{% block css %}
{% assets "css_invoice" -%}
<link rel="stylesheet" href="{{ ASSET_URL }}">
{% endassets -%}
{% endblock %}

{% block document %}
<div class="container invoice">
  <div class="main-row">
    <div class="col-md-10 col-md-offset-1 main-column">

      <div id="main-content" class="{% if payment.state == 'cancelled' -%} cancelled {%- endif %}">

{% block body %}

<div class="sender-row">
  <div class="title">
    <h2>{% if payment.state == 'paid' -%} Receipt {%- else -%} Invoice {%- endif %}</h2>
  </div>

  <div class="sender">
    <img class="logo" src="{{ url_for('static', filename='images/logomark-black.svg') }}" height="80"/>
    <div class="vcard">
      <div class="fn org">Electromagnetic Field Ltd.</div>
      <div class="adr">
        <span class="street-address">2 Ockendon Mews</span>
        <span class="locality">London</span>
        <span class="postal-code">N1 3JL</span>
        <span class="country-name">UNITED KINGDOM</span>
      </div>
    </div>
  </div>

<div class="recipient-row">
  <div class="recipient">
    <div>{{ payment.user.name }}</div>
    <div>{{ payment.user.email }}</div>
  </div>

  <div class="invoice-details">
    <dl class="dl-horizontal">
      <dt>Invoice date</dt><dd>{{ payment.versions[0].transaction.issued_at.strftime('%d %b %Y') }}</dd>
      <dt>Invoice number</dt><dd>{{ payment.invoice_number() }}</dd>
      <dt>VAT number</dt><dd>188170679</dd>
    </dl>
  </div>
</div>

<table class="table">
<thead>
<tr>
  <th>Product</th>
  <th>Unit price</th>
  <th>Quantity</th>
  <th>Amount</th>
</tr>
</thead>

<tbody>
{% set line_class = cycler('odd', 'even') %}

{%- for pt, count in invoice_lines -%}
<tr class="purchase {{ line_class.next() }}">
<td>{{ pt.parent.display_name }}</td>
<td>{{ pt.get_price(payment.currency).value_ex_vat | price(payment.currency) }}</td>
<td>{{ count }}
<td>{{ (pt.get_price(payment.currency).value_ex_vat * count) | price(payment.currency) }}</td>
</tr>
{% endfor -%}

{#
{% if payment.provider == 'stripe' %}
<tr class="premium {{ line_class.next() }}">
<td>Credit Card Premium</td>
<td>{{ premium | price(payment.currency) }}</td>
<td>{{ 1 }}
<td>{{ premium | price(payment.currency) }}
</tr>
{% endif %}
#}

</tbody>

<tfoot>
<tr class="subtotal {{ line_class.next() }}">
<td colspan=2></td>
<td>Subtotal</td>
<td>{{ subtotal | price(payment.currency) }}</td>
</tr>

<tr class="vat {{ line_class.next() }}">
<td colspan=2></td>
<td>VAT at 20%</td>
<td>{{ vat | price(payment.currency) }}</td>
</tr>

<tr class="total {{ line_class.next() }}">
<td colspan=2></td>
<td>Total</td>
<td>{{ payment.amount | price(payment.currency) }}</td>
</tr>

</tfoot>

</table>

{% if payment.state == 'paid' %}
<div class="paid">Payment already received - thank you!</div>
{% else %}
<div class="payment-terms">
  {% if payment.expires %}
  <div class="due-date">Due Date: {{ payment.expires.strftime('%d %b %Y') }}</div>
  {% endif %}
  {% if payment.provider == 'banktransfer' %}
  <dl class="bank-info dl-horizontal">
  <dl class="dl-horizontal">
    <dt>Bank</dt><dd>Barclays Bank PLC, 19 Fleet Street, London EC4Y 1AA, UK</dd>
    <dt>Payee</dt><dd>Electromagnetic Field Ltd</dd>
    {% if payment.currency == 'GBP' %}
    <dt>Sort code</dt><dd>20-71-64</dd>
    <dt>Account number</dt><dd>73590526</dd>
    <!--<dt>IBAN</dt><dd>GB39 BARC 2071 6473 5905 26</dd>-->
    {% elif payment.currency == 'EUR' %}
    <dt>SWIFT</dt><dd>BARCGB22</dd>
    <dt>IBAN</dt><dd>GB21 BARC 2071 6472 9544 33</dd>
    {% endif %}
    <dt>Reference</dt><dd>{{ payment.bankref | bankref }}</dd>
  </dl>
  {% elif payment.provider == 'gocardless' and payment.state != 'inprogress' %}
  <div>Payment to be made online at {{ external_url('payments.gocardless_tryagain', payment_id=payment.id) }}</div>
  {% elif payment.provider == 'stripe' %}
  <div>Payment to be made online at {{ external_url('payments.stripe_tryagain', payment_id=payment.id) }}</div>
  {% endif %}
</div>
{% endif %}

<div>For terms and conditions, see {{ external_url('payments.terms') }}</div>

{% endblock %}

      </div>

      <footer>
        {# We don't really need this but people expect it, and it hints that it's printable #}
        <dl class="company-info">
          <dt>Company Registration No</dt><dd>07788466</dd>
          <dt>Registered Office</dt><dd>2 Ockendon Mews, London, N1 3JL, United Kingdom</dd>
        </div>
      </footer>
    </div>
  </div>
</div>
{% endblock %}

