{% from "_formhelpers.html" import render_dl_field %}

{% extends "cfp_review/base.html" %}
{% block body %}

{% set active='details' %}
{% include "cfp_review/_propsal_tabs.html" %}

<div>&nbsp;</div>
<form method="post" action="{{ url_for('.update_proposal', proposal_id=proposal.id) }}" class="shrink">
{{ form.hidden_tag() }}
    <div class="col-md-8">
        <h2>{{proposal.title}} <small>by {{proposal.user.name}}</small></h2>
        <dl class="dl-horizontal">
            <dt>Date</dt>
            <dd>{{proposal.created.strftime("%Y-%m-%d %H:%M")}}</dd>
            <dt>Submitter</dt>
            <dd>{{proposal.user.name}}</dd>
            <dt>E-Mail</dt>
            <dd>{{proposal.user.email}}</dd>
            <dt>Anoymised by</dt>
            <dd>
                {% if proposal.anonymiser_id %}
                    {{ proposal.anonymiser.name }}
                {% else %}
                    --
                {% endif %}
            </dd>
            <dt>Type</dt>
            <dd>{{proposal.type}}</dd>
            {{ render_dl_field(form.state, tabindex=1) }}
            {{ render_dl_field(form.title, tabindex=3) }}
            {{ render_dl_field(form.description, tabindex=4, rows=10) }}
            {{ render_dl_field(form.requirements, tabindex=5) }}
            {{ render_dl_field(form.length, tabindex=6) }}
            {{ render_dl_field(form.notice_required, tabindex=7) }}
            {{ render_dl_field(form.needs_help, tabindex=8) }}
            {{ render_dl_field(form.needs_money, tabindex=9) }}
            {{ render_dl_field(form.one_day, tabindex=10) }}
            {% if proposal.type == 'talk' %}
                {{ render_dl_field(form.category, tabindex=11) }}
            {% elif proposal.type == 'workshop' %}
                {{ render_dl_field(form.attendees, tabindex=11) }}
                {{ render_dl_field(form.cost, tabindex=12) }}
            {% elif proposal.type == 'installation' %}
                {{ render_dl_field(form.size, tabindex=11) }}
                {{ render_dl_field(form.funds, tabindex=12) }}
            {% endif %}
        </dl>
    </div>
    <div class="col-md-4 col-xs-12 btn-group-vertical" role="group">
        <div>&nbsp;</div>
        {% if proposal.state == 'locked' %}
            {{ form.checked(class_="btn btn-success", tabindex=13) }}
            {{ form.reject(class_="btn btn-danger", tabindex=15) }}
        {% endif %}
        {{ form.update(class_="btn btn-danger", tabindex=14) }}

        {% if next_id %}
            <a href="{{ url_for('.update_proposal', proposal_id=next_id) }}"
                class="btn btn-default">
                Next {{proposal.state}} proposal
            </a>
        {% else %}
            <a href="{{ url_for('.proposals', state=proposal.state) }}"
                class="btn btn-default">
                All remaining {{proposal.state}} proposals
            </a>
        {% endif %}
    </div>
</form>

{% endblock %}
